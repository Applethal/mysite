{{ define "main" }}

<style>
    .tikzs {
        text-align: center;
        background-color: white;
        width: fit-content;
        margin: auto;
        padding: 20px;
        border-radius: 8px;

    }
    .flex-container {
        display: flex;
        justify-content: flex-start;
        align-items: stretch;

        height: 100%;
        padding: 15px;
        gap: 5px;
    }

    .flex-container>div {
        background-color: #3d3d3d;
        border: 3px solid #000000;
        border-radius: 5px;
        padding: 8px;
    }

    .item1 {
        align-self: auto;
        display: inline-block;
        
        max-height: 100%;

    }

    .item2 {
        flex-grow: 0;
        align-self: center;
        min-width: 220px;
        
    }

    .info {
        display: flex;
        flex-direction: column;
        background-color: grey;
        max-height: 100%;
        padding: 15px;
        gap: 5px;
    }

    .info>div {
        background: #979797;
        border: 3px solid #000000;
        border-radius: 5px;
        padding: 8px;
    }

    @media (max-width: 767px) {

        
        .flex-container {
            flex-direction: column;
        }

        .item2 {
            align-self: center;
            min-width: unset;
            
        }
    }
</style>
<script src="https://tikzjax.com/v1/tikzjax.js"></script>
{{ $tasks := .Params.tasks }}
<script>


var processSteps = [
    {{- range $index, $task := $tasks -}}
      {
        id: {{ $task.id }},
        name: "{{ $task.name }}",
        machine: "{{ $task.machine }}",
        processing_time: {{ $task.processing_time }},
        dependencies: [{{ range $task.dependencies }}{{ . }},{{ end }}],
      },
    {{- end -}}
  ];


    function calculateSchedule(processSteps) {
        const tasks = processSteps.map((step, index) => ({
            id: index + 1,
            name: step.name,
            machine: step.machine,
            processingTime: step.processing_time,
            dependencies: step.dependencies,
            startTime: 0,
            finishTime: 0,
        }));

        for (const task of tasks) {
            task.startTime = Math.max(...task.dependencies.map(depId => tasks[depId - 1].finishTime), 0);
            task.finishTime = task.startTime + task.processingTime;
        }

        const makespan = Math.max(...tasks.map(task => task.finishTime));

        return { makespan, tasks };
    }


    const scheduleResult = calculateSchedule(processSteps);
    console.log('Makespan:', scheduleResult.makespan);
    console.log('Task Schedule:');
    scheduleResult.tasks.forEach(task => {
        console.log(`${task.name}: Start Time ${task.startTime}, Finish Time ${task.finishTime}, Machine ${task.machine}`);
    });



</script>



<div class="flex-container">
    <div class="item2">
        <div class="info">
            <img src="/{{.File.BaseFileName}}.png" width="100%" height="100%" loading="lazy"
                style="border: 3px solid #000000;">
            <div class="ingredients">
                <h2 id="ingredientsTitle" style="text-align: center;">{{.Title}}</h2>
                <p>{{ with .Params.ingredients }}
                <ul id="ingredientsList">
                    {{ range . }}
                    <li>{{ . }}</li>
                    {{ end }}
                </ul>
                {{ end }}</p>
            </div>
        </div>
    </div>
    <div class="item1">
        {{.Content}}

    </div>




</div>

<div class="tikzs">
    <script type="text/tikz">
        \begin{tikzpicture}[scale=0.7]
        \draw[->] (0,0) -- (14,0) node[right] {};
    \draw[->] (0,0) -- (0,7) node[above] {};
    
    
    \draw[gray!50, dashed, step=1] (0,0) grid (14,7);
    
    
    \foreach \x in {1,2,...,14} {
        \draw (\x,0) -- (\x,-0.2) node[below] {\x};
    }
    
    
    \foreach \y/\label in {3/Human, 7/Stove} {
        \draw (0,\y) -- (-0.2,\y) node[left] {\label};
    }
    \draw[fill=blue!30] (0,0) rectangle (3,3) node[pos=0.5] {Egg};
    \draw[fill=blue!30] (3,0) rectangle (5,3) node[pos=.5] {Cut};
    
    \draw[fill=blue!30] (5,3) rectangle (10,7) node[pos=.5] {Cook};
    \draw[fill=blue!30] (5,0) rectangle (8,3) node[pos=.5] {Bread};
    \draw[fill=blue!30] (10,0) rectangle (12,3) node[pos=.5] {Stuff};
    \draw[fill=red!30, line width=1.5pt] (12,0) rectangle (12,7) node[pos=1, right=2mm] {$C_{max} = 12$};

    
    \end{tikzpicture}
      </script>

</div>

{{ end }}